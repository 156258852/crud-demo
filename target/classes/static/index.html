<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Todo BFF Demo</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f7fa;
    }
    #app {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 25px;
    }
    h2 {
      color: #2c3e50;
      margin-top: 0;
      text-align: center;
      border-bottom: 2px solid #3498db;
      padding-bottom: 15px;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    input:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
    .edit-btn, .save-btn, .cancel-btn {
      background-color: #f39c12;
      padding: 6px 12px;
      font-size: 14px;
      margin-right: 5px;
    }
    .edit-btn:hover, .save-btn:hover, .cancel-btn:hover {
      background-color: #d35400;
    }
    .save-btn {
      background-color: #3498db;
    }
    .save-btn:hover {
      background-color: #2980b9;
    }
    .cancel-btn {
      background-color: #95a5a6;
    }
    .cancel-btn:hover {
      background-color: #7f8c8d;
    }
    .toggle-btn {
      background-color: #2ecc71;
      padding: 6px 12px;
      font-size: 14px;
      margin-right: 5px;
    }
    .toggle-btn:hover {
      background-color: #27ae60;
    }
    .delete-btn {
      background-color: #e74c3c;
      padding: 6px 12px;
      font-size: 14px;
    }
    .delete-btn:hover {
      background-color: #c0392b;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin-bottom: 8px;
      background-color: #f8f9fa;
      border-radius: 4px;
      border-left: 4px solid #3498db;
    }
    li:nth-child(even) {
      border-left-color: #2ecc71;
      background-color: #f0faf5;
    }
    .todo-text {
      flex: 1;
      word-break: break-word;
      padding-right: 15px;
    }
    .completed {
      text-decoration: line-through;
      color: #95a5a6;
    }
    .editing-input {
      flex: 1;
      padding: 8px;
      border: 1px solid #3498db;
      border-radius: 4px;
      margin-right: 10px;
    }
    .empty-state {
      text-align: center;
      color: #95a5a6;
      font-style: italic;
      padding: 20px;
    }
  </style>
</head>
<body>
<div id="app">
  <h2>Todo List</h2>
  <div class="input-group">
    <input v-model="text" @keyup.enter="add" placeholder="输入新的待办事项...">
    <button @click="add">添加</button>
  </div>
  <ul v-if="todos.length > 0">
    <li v-for="t in todos" :key="t.id">
      <span v-if="!t.editing" class="todo-text" :class="{ 'completed': t.done }">{{ t.text }}</span>
      <input v-else v-model="t.editText" class="editing-input" @keyup.enter="finishEdit(t)" />
      <div>
        <button v-if="!t.editing" class="edit-btn" @click="startEdit(t)">编辑</button>
        <button v-if="t.editing" class="save-btn" @click="finishEdit(t)">保存</button>
        <button v-if="t.editing" class="cancel-btn" @click="cancelEdit(t)">取消</button>
        <button class="toggle-btn" @click="toggle(t)">
          {{ t.done ? '标记未完成' : '标记完成' }}
        </button>
        <button class="delete-btn" @click="del(t.id)">删除</button>
      </div>
    </li>
  </ul>
  <div v-else class="empty-state">
    暂无待办事项，添加一个新的吧！
  </div>
</div>
<script>
  const { createApp, ref, onMounted } = Vue;
  
  createApp({
    setup() {
      const todos = ref([]);
      const text = ref('');
      
      const api = {
        fetchTodos: () => axios.get('/api/todo'),
        createTodo: (data) => axios.post('/api/todo', data),
        updateTodo: (id, data) => axios.put(`/api/todo/${id}`, data),
        deleteTodo: (id) => axios.delete(`/api/todo/${id}`),
        toggleTodo: (id) => axios.patch(`/api/todo/${id}/toggle`)
      };
      
      const loadTodos = async () => {
        try {
          const response = await api.fetchTodos();
          todos.value = response.data.map(todo => ({
            ...todo,
            editing: false,
            editText: todo.text
          }));
        } catch (error) {
          console.error('加载待办事项失败:', error);
          alert('加载数据失败，请刷新页面重试');
        }
      };
      
      const addTodo = async () => {
        if (!text.value.trim()) return;
        
        try {
          await api.createTodo({ text: text.value, done: false });
          text.value = '';
          await loadTodos();
        } catch (error) {
          console.error('添加待办事项失败:', error);
          alert('添加失败，请重试');
        }
      };
      
      const deleteTodo = async (id) => {
        try {
          await api.deleteTodo(id);
          await loadTodos();
        } catch (error) {
          console.error('删除待办事项失败:', error);
          alert('删除失败，请重试');
        }
      };
      
      const startEdit = (todo) => {
        todo.editing = true;
        todo.editText = todo.text;
      };
      
      const finishEdit = async (todo) => {
        if (!todo.editText.trim()) {
          alert('待办事项不能为空！');
          return;
        }
        
        try {
          await api.updateTodo(todo.id, { 
            text: todo.editText, 
            done: todo.done 
          });
          await loadTodos(); // 重新加载列表
        } catch (error) {
          console.error('更新待办事项失败:', error);
          alert('更新失败，请重试');
        }
      };
      
      const cancelEdit = (todo) => {
        todo.editing = false;
        todo.editText = todo.text;
      };
      
      const toggleTodoStatus = async (todo) => {
        try {
          const response = await api.toggleTodo(todo.id);
          // 更新本地数据
          const index = todos.value.findIndex(item => item.id === todo.id);
          if (index !== -1) {
            todos.value[index] = response.data;
          }
        } catch (error) {
          console.error('切换待办事项状态失败:', error);
          alert('状态切换失败，请重试');
        }
      };
      
      onMounted(() => {
        loadTodos();
      });
      
      // 返回响应式数据和方法
      return {
        todos,
        text,
        loadTodos,
        add: addTodo,
        del: deleteTodo,
        startEdit,
        finishEdit,
        cancelEdit,
        toggle: toggleTodoStatus
      };
    }
  }).mount('#app');
</script>
</body>
</html>